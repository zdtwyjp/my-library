function Calendar_addEvent(element, e, fn) {
	if (element.addEventListener) {
		element.addEventListener(e, fn, false)
	} else {
		element.attachEvent('on' + e, fn)
	}
};
var Calendar = {
	OID: '',
	$: function(o) {
		return document.getElementById(o)
	},
	isDate: function(dateStr) {
		var datePat = /^(\d{4})([\/-])(\d{1,2})([\/-])(\d{1,2})$/;
		dateStr = String(dateStr).replace(/^\s*|\s*$/g, '');
		var matchArray = dateStr.match(datePat);
		if (matchArray == null) {
			return false
		};
		var month = matchArray[3];
		var day = matchArray[5];
		var year = matchArray[1];
		if (month < 1 || month > 12) {
			return false
		};
		if (day < 1 || day > 31) {
			return false
		};
		if ((month == 4 || month == 6 || month == 9 || month == 11) && day == 31) {
			return false
		};
		if (month == 2) {
			var isleap = (year % 4 == 0 && (year % 100 != 0 || year % 400 == 0));
			if (day > 29 || (day == 29 && !isleap)) {
				return false
			}
		};
		return true
	},
	calendarHTML: new
	function() {
		if (document.getElementById('CalendarBox')) {
			document.body.removeChild(document.getElementById('CalendarBox'))
		};
		var styleStr = '';
		styleStr += 'body{margin:0px;padding:0px;}';
		styleStr += '#CalendarBox{margin:auto;width:150px;z-index:1001;position:absolute;}';
		styleStr += '#CalendarBox *{margin:0px;padding:0px;text-align:center;font-family:Verdana,Arial,Simsun;font-size:12px;line-height:18px;}';
		styleStr += '#CalendarBox #CalendarDivMain{margin:auto;text-align:center;background:#ffffff;z-index:10011;zoom:1;position:relative;border:1px #86b9d6 solid;}';
		styleStr += '#CalendarBox .CalendarHead{background:#c2deed;padding-top:2px;padding-bottom:2px;}';
		styleStr += '#CalendarBox #CalendarIfrBg{width:10px;height:10px;border:none;top:0px;left:0px;position:absolute;z-index:10001;}';
		styleStr += '#CalendarBox #Calendar{padding-left:0px;clear:both;overflow:hidden;padding-bottom:4px;}';
		styleStr += '#CalendarBox dl{padding-left:4px;clear:both;margin:auto;overflow:hidden;}';
		styleStr += '#CalendarBox dl.weeks{background:#ffffd9;zoom:1;}';
		styleStr += '#CalendarBox dl.weeks dt{background:#ffffd9;}';
		styleStr += '#CalendarBox #CalendarDay{clear:both;display:block;zoom:1;}';
		styleStr += '#CalendarBox dt,#CalendarBox dd,#CalendarBox span{width:18px;height:18px;display:block;float:left;overflow:hidden;zoom:1;border:1px solid #fff;}';
		styleStr += '#CalendarBox dl dt{border:1px #ffffd9 solid;}';
		styleStr += '#CalendarBox dt{margin-top:0px;color:#666666;}';
		styleStr += '#CalendarBox #CalendarDay dd{color:#666666;cursor:pointer;}';
		styleStr += '#CalendarBox #CalendarBtnHide{width:16px;height:16px;font-size:16px;font-weight:bold;line-height:16px;display:block;cursor:pointer;border:1px red solid;color:red;}';
		styleStr += '#CalendarBox #CalendarToday{margin:0 4px;border:1px #fff solid;height:18px;cursor:pointer;}';
		styleStr += '#CalendarBox .slt{background:#eee;border:1px #e0e0e0 solid!important;color:#f60;text-decoration:underline;}';
		var style = document.createElement('style');
		var styleText = document.createTextNode(styleStr);
		style.type = 'text/css';
		if (style.styleSheet) {
			style.styleSheet.cssText = styleText.nodeValue
		} else {
			style.appendChild(styleText)
		};
		var DDiv = document.createElement('div');
		DDiv.id = 'CalendarBox';
		DDiv.style.position = 'absolute';
		DDiv.left = '-5000px';
		DDiv.top = '-5000px';
		DDiv.style.zIndex = '1001';
		DDiv.style.display = 'none';
		DDiv.style.margin = 'auto';
		DDiv.style.width = '150px';
		var temHTML = ' <div id="CalendarDivMain">' + ' <div class="CalendarHead">' + '   <table width="100%" border="0" cellpadding="0" cellspacing="2"><tr>' + '    <td><select id="Year" name="Year"></select></td>' + '    <td><select id="Month" name="Month"></select></td>' + '    <td width="20"><span id="CalendarBtnHide">×</span></td>' + '   </tr></table>' + ' </div>' + ' <div id="Calendar">' + '   <dl class="weeks"><dt>日</dt><dt>一</dt><dt>二</dt><dt>三</dt><dt>四</dt><dt>五</dt><dt>六</dt></dl>' + '   <dl id="CalendarDay">日期列表选项</dl>' + ' <p id="CalendarToday">今天：2010-12-11</p></div></div>' + ' <iframe id="CalendarIfrBg" frameborder="0"></iframe>';
		DDiv.innerHTML = temHTML;
		Calendar_addEvent(window, 'load',
		function(){
			document.getElementsByTagName('head')[0].appendChild(style);
			document.body.appendChild(DDiv)
		})
	},
	alignPos: function() {
		var pos = $(this.OID).offset();
		pos.x = pos.left;
		pos.y = pos.top + $(this.OID).outerHeight();
		return pos
	},
	getToday: new
	function() {
		this.now = new Date();
		this.year = this.now.getFullYear();
		this.month = this.now.getMonth() + 1;
		this.day = this.now.getDate()
	},
	thisDay: function() {
		var D = this.OID.value;
		var Day = {};
		if (this.isDate(D)) {
			var exp = /^(\d{4})-(\d{1,2})-(\d{1,2})$/;
			if (exp.test(D)) {
				D = D.split('-')
			} else {
				D = D.split('/')
			};
			Day.now = new Date(parseFloat(D[0]), parseFloat(D[1]) - 1, parseFloat(D[2]));
			Day.year = Day.now.getFullYear();
			Day.month = Day.now.getMonth() + 1;
			Day.day = Day.now.getDate()
		} else {
			Day.now = this.getToday.now;
			Day.year = Day.now.getFullYear();
			Day.month = Day.now.getMonth() + 1;
			Day.day = Day.now.getDate()
		};
		return Day
	},
	setYear: function() {
		var Year = this.$('Year');
		var year = Number(this.getToday.year);
		var Day = this.thisDay();
		for (y = year - 30; y <= year+70; y++) {
			Year.options[Year.options.length] = new Option(y, y);
			if (Day.year == y) {
				Year.options[Year.options.length - 1].selected = true
			}
		}
	},
	setMonth: function() {
		var Month = this.$('Month');
		var Day = this.thisDay();
		for (m = 1; m <= 12; m++) {
			Month.options[Month.options.length] = new Option(m + '月', m);
			if (Day.month == m) {
				Month.options[Month.options.length - 1].selected = true
			}
		}
	},
	setDay: function(flag) {
		var $now = new Date();
		var $nowY = $now.getFullYear();
		var $nowM = $now.getMonth() + 1;
		var $nowD = $now.getDate();
		if($nowM.toString().length<2)$nowM = '0'+ $nowM;
		if($nowD.toString().length<2)$nowD = '0'+ $nowD;
		$now = $nowY + '-' + $nowM + '-' + $nowD;
		var y = this.thisDay().year;
		var m = this.thisDay().month;
		if (flag) {
			y = this.$('Year').value;
			m = this.$('Month').value
		}
		var day = this.getDays(y, m);
		var d = new Date(y, m - 1, 1).getDay();
		var _d = this.thisDay().day;
		var dayStr = '';
		for (t = 0; t < d; t++) {
			dayStr += '<span></span>'
		};
		for (t = 1; t <= day; t++) {
			if (t == _d) {
				dayStr += '<dd class="slt" style="border:1px #f60 solid;background:#ffffaa;color:#333;text-decoration:none;" onclick="Calendar.getDay(' + t + ')">' + t + '</dd>'
			} else {
				dayStr += '<dd onclick="Calendar.getDay(' + t + ')">' + t + '</dd>'
			}
		};
		this.$('CalendarDay').innerHTML = dayStr;
		var CalendarToday = this.$('CalendarToday');
		CalendarToday.innerHTML = CalendarToday.title = '今天：' + $now;
		CalendarToday.onclick = function() {
			Calendar.OID.value = $now;
			Calendar.flag = 'ok'
		};
		CalendarToday.onmouseover = function() {
			this.className = 'slt'
		};
		CalendarToday.onmouseout = function() {
			this.className = ''
		};
		this.reIframe()
	},
	onChange: function() {
		Calendar.setDay(true);
		Calendar.mousDay()
	},
	getDay: function(d) {
		var y = this.$('Year').value;
		var m = this.$('Month').value;
		if (m < 10) {
			m = '0' + m
		};
		if (d < 10) {
			d = '0' + d
		};
		this.OID.value = y + '-' + m + '-' + d;
		Calendar.flag = 'ok';
		this.$('CalendarBox').style.display = 'none'
	},
	getDays: function(y, m) {
		return m == 2 ? (y % 4 || !(y % 100) && y % 400 ? 28 : 29) : (/4|6|9|11/.test(m) ? 30 : 31)
	},
	mousDay: function() {
		var days = this.$('CalendarDay').getElementsByTagName('dd');
		for (d = 0; d < days.length; d++) {
			days[d].onmouseover = function() {
				this.className = 'slt'
			};
			days[d].onmouseout = function() {
				this.className = ''
			}
		}
	},
	reIframe: function() {
		var IfrBg = this.$('CalendarIfrBg');
		var RlDiv = this.$('CalendarBox');
		if (RlDiv.style.display == 'none') {
			return false
		};
		IfrBg.style.width = parseInt(RlDiv.offsetWidth - 2) + 'px';
		IfrBg.style.height = parseInt(RlDiv.offsetHeight - 2) + 'px'
	},
	Show: function() {
		var CalendarBox = this.$('CalendarBox');
		CalendarBox.style.left = this.alignPos().x + 'px';
		CalendarBox.style.top = this.alignPos().y + 'px';
		var dis = CalendarBox.style.display;
		if (dis == 'none') {
			CalendarBox.style.display = 'block'
		}
		this.$('CalendarBtnHide').onclick = function() {
			Calendar.flag = 'ok'
		}
	},
	Hide: function() {
		var CalendarBox = this.$('CalendarBox');
		CalendarBox.style.left = '-5000px';
		CalendarBox.style.top = '-5000px';
		CalendarBox.style.display = 'none'
	},
	Build: function(O) {
		this.OID = O;
		var Year = this.$('Year');
		var Month = this.$('Month');
		Year.options.length = 0;
		Month.options.length = 0;
		Year.onchange = this.onChange;
		Month.onchange = this.onChange;
		Calendar.Show();
		Calendar.setYear();
		Calendar.setMonth();
		Calendar.setDay();
		Calendar.mousDay();
		this.$('CalendarBox').onclick = function(e) {
			if (Calendar.flag == 'ok') {
				Calendar.flag = true
			} else {
				Calendar.flag = 'stop'
			}
		};
		document.onclick = function(e) {
			e || (e = window.event);
			var src = e.target || e.srcElement;
			var tmp = src.nodeName.toUpperCase();
			if (Calendar.flag == true && (src.id != Calendar.OID.id)) {
				Calendar.$('CalendarBox').style.display = 'none';
				Calendar.flag = false;
				return false
			} else if ((Calendar.flag == false || Calendar.flag == undefined) && src.id == Calendar.OID.id || Calendar.flag == 'stop') {
				Calendar.$('CalendarBox').style.display = 'block';
				Calendar.flag = true;
				return false
			}else if(src.id == Calendar.OID.id){
				Calendar.$('CalendarBox').style.display = 'block';
				Calendar.flag = true;
				return false
			}
		}
	},
	init: function(O) {
		this.Build(O)
	}
};